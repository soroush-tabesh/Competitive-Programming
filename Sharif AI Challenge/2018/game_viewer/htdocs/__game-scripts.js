var FollowMouse=pc.createScript("followMouse");FollowMouse.attributes.add("map",{type:"number",default:10,min:10,max:25}),FollowMouse.prototype.initialize=function(){this.pos=new pc.Vec3,this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this)},FollowMouse.prototype.update=function(t){var o=this.entity;o.getPosition().x>=-1.75*this.map&&o.getPosition().x<1.75*this.map&&o.getPosition().z>=-1.75*this.map&&o.getPosition().z<1.75*this.map?"path"==this.entity.name?o.setLocalScale(3.5,1,3.5):o.setLocalScale(1,1,1):o.setLocalScale(0,0,0)},FollowMouse.prototype.onMouseMove=function(t){var o=this.positioning(t);this.entity.setPosition(o)},FollowMouse.prototype.modFunc=function(t,o){return t-t%o},FollowMouse.prototype.positioning=function(t){var o=Math.PI/180,s=this.app.root.findByName("Main Camera");s.camera.screenToWorld(t.x,t.y,10,this.pos);var e=this.pos.x,i=this.pos.y,n=this.pos.z,a=s.getEulerAngles().x*o,p=s.getEulerAngles().y*o,h=s.getEulerAngles().z*o,l=Math.cos(a)*Math.sin(p)*Math.cos(h)+Math.sin(a)*Math.sin(h),c=Math.cos(a)*Math.sin(p)*Math.sin(h)-Math.sin(a)*Math.cos(h),u=Math.cos(a)*Math.cos(p),M=e-i*l/c,r=n-i*u/c;return new pc.Vec3(this.modFunc(M,3.5),.71,this.modFunc(r,3.5))};var MakeGround=pc.createScript("makeGround");MakeGround.attributes.add("greenModel",{type:"asset",assetType:"model"}),MakeGround.attributes.add("earthModel",{type:"asset",assetType:"model"}),MakeGround.attributes.add("waterModel",{type:"asset",assetType:"model"}),MakeGround.attributes.add("treeModel",{type:"asset",assetType:"model"}),MakeGround.attributes.add("stoneModel",{type:"asset",assetType:"model"}),MakeGround.attributes.add("map",{type:"number",default:10,min:10,max:25,precision:10}),Object.defineProperty(MakeGround.prototype,"table",{value:[],writable:!0});var ground=new Array(0);MakeGround.prototype.initialize=function(){this.camera=this.app.root.findByName("Camera"),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseUp,this);var e=prompt("Please enter your map size","20");if(null!==e){this.map=e;for(var t=this.app.root.findByName("model holder"),o=0;o<t.children.length;o++)t.children[o].script.followMouse.map=e;this.app.root.findByName("Main Camera").script.orthoHeight.map=e,this.app.fire("makeGround:ortho")}this.setFirstGround()},MakeGround.prototype.setFirstGround=function(){var e,t,o=this.app.root.findByName("Ground Holder"),a=-1.75*this.map,r=1.75*this.map;for(e=a;e<r;e+=3.5){var n="";for(t=a;t<r;t+=3.5){var i=new pc.Entity;i.name="green block",i.addComponent("model"),i.model.type="asset",i.model.asset=this.greenModel,i.setPosition(e,0,t),o.addChild(i);var s=new pc.Vec4(0,e,t,0);ground.push(s),n+="g"}this.table.push(n)}},MakeGround.prototype.setGround=function(e,t,o){String.prototype.replaceAt=function(e,t){return this.substr(0,e)+t+this.substr(e+t.length)};var a,r,n=this.app.root.findByName("Ground Holder"),i=this.app.root.findByName("model holder").children;for(a=0;a<i.length;a++)if(!0===i[a].enabled){r=i[a];break}switch(r.name){case"dirt":0===ground[e].w&&(this.table[t]=this.table[t].replaceAt(o,"r"),ground[e].x=1,n.children[e].name="earth block",n.children[e].model.asset=this.earthModel);break;case"grass":this.table[t]=this.table[t].replaceAt(o,"g"),ground[e].x=0,n.children[e].name="green block",n.children[e].model.asset=this.greenModel;break;case"water":0===ground[e].w&&(this.table[t]=this.table[t].replaceAt(o,"w"),ground[e].x=2,n.children[e].name="water block",n.children[e].model.asset=this.waterModel);break;case"tree":var s=new pc.Entity;s.name="tree block",s.addComponent("model"),s.model.type="asset",s.model.asset=this.treeModel,s.setPosition(ground[e].y,.687,ground[e].z),0===ground[e].x&&0===ground[e].w&&(ground[e].w=1,this.app.root.addChild(s),this.table[t]=this.table[t].replaceAt(o,"A"));break;case"stone":var d=new pc.Entity;d.name="stone block",d.addComponent("model"),d.model.type="asset",d.model.asset=this.stoneModel,d.setPosition(ground[e].y,.687,ground[e].z),0===ground[e].x&&0===ground[e].w&&(ground[e].w=2,this.app.root.addChild(d),this.table[t]=this.table[t].replaceAt(o,"B"));break;case"path":var l=new pc.Entity;if(l.name="path block",l.addComponent("model",{type:"plane"}),l.setLocalScale(3.5,1,3.5),l.setPosition(ground[e].y,.71,ground[e].z),1==ground[e].x&&0===ground[e].w){var p=this.app.root.findByName("New Path");this.checkForRepetition(p,l)||p.addChild(l)}break;case"eraser":if("A"==this.table[t][o]||"B"==this.table[t][o]){this.table[t]=this.table[t].replaceAt(o,"g"),ground[e].x=1,ground[e].w=0;var h=this.app.root.find("name","tree block");h.push.apply(h,this.app.root.find("name","stone block"));var u=new pc.Vec3(ground[e].y,.687,ground[e].z);for(a=0;a<h.length;a++)if(h[a].getPosition().x==u.x&&h[a].getPosition().z==u.z){h[a].destroy();break}}}},MakeGround.prototype.checkForRepetition=function(e,t){for(var o=!1,a=0;a<e.children.length;a++)e.children[a].getPosition().x==t.getPosition().x&&e.children[a].getPosition().z==t.getPosition().z&&(o=!0);return o},MakeGround.prototype.onMouseUp=function(e){for(var t,o=this.app.root.findByName("model holder").children,a=0;a<o.length;a++)if(!0===o[a].enabled){t=o[a];break}if(null!==t&&void 0!==t){var r=t.getPosition().x+1.75*this.map,n=t.getPosition().z+1.75*this.map;a=r/3.5;var i=n/3.5;a-=a%1,i-=i%1;var s=a*this.map+i;a>=0&&i>=0&&a<this.map&&i<this.map&&this.setGround(s,a,i)}};var UiInput=pc.createScript("uiInput");UiInput.attributes.add("hoverAsset",{type:"asset",assetType:"texture"}),UiInput.attributes.add("activeAsset",{type:"asset",assetType:"texture"}),UiInput.prototype.initialize=function(){this.activeCamera=this.app.root.findByName("Main Camera"),this.originalTexture=this.entity.element.textureAsset,this.hovered=!1,this.entity.element.on("mouseenter",this.onEnter,this),this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("mouseleave",this.onLeave,this)},UiInput.prototype.update=function(e){},UiInput.prototype.onEnter=function(e){this.hovered=!0,e.element.textureAsset=this.hoverAsset,document.body.style.cursor="pointer"},UiInput.prototype.onLeave=function(e){this.hovered=!1,e.element.textureAsset=this.originalTexture,document.body.style.cursor="default"},UiInput.prototype.onPress=function(e){switch(e.element.textureAsset=this.activeAsset,this.entity.name){case"btn_1":this.setCamera("Main Camera");break;case"btn_2":this.setCamera("Camera 2");break;case"btn_3":this.setCamera("Camera 3");break;case"btn_4":this.setCamera("Camera 4");break;case"btn_5":this.setCamera("Camera 5");break;case"btn_6":this.setCamera("Camera 6");break;case"btn_7":this.setCamera("Camera 7");break;case"btn_8":this.setCamera("Camera 8");break;case"btn_9":this.setCamera("Camera 9")}},UiInput.prototype.onRelease=function(e){e.element.textureAsset=this.hovered?this.hoverAsset:this.originalTexture},UiInput.prototype.setCamera=function(e){this.activeCamera.enabled=!1,this.activeCamera=this.app.root.findByName(e),this.activeCamera.enabled=!0};var Toolbar=pc.createScript("toolbar");Toolbar.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),Toolbar.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),Toolbar.attributes.add("script",{type:"asset",assetType:"script"}),Toolbar.prototype.initialize=function(){var e=document.createElement("style");document.head.appendChild(e),e.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container"),this.div.innerHTML=this.html.resource||"",document.body.appendChild(this.div),this.bindEvents()},Toolbar.prototype.bindEvents=function(){var e=this.app,t=e.root.findByName("model holder").children,r=this.div.querySelector("#green"),n=this.div.querySelector("#earth"),o=this.div.querySelector("#tree"),a=this.div.querySelector("#rock"),d=this.div.querySelector("#eraser"),i=this.div.querySelector("#path"),s=this.app.root.findByName("Main Camera");r.addEventListener("click",function(){for(var r=0;r<t.length;r++)t[r].enabled=!1;e.root.findByName("grass").enabled=!0,document.body.style.cursor="default",s.script.mouseInput.runable=!1},!1),n.addEventListener("click",function(){for(var r=0;r<t.length;r++)t[r].enabled=!1;e.root.findByName("dirt").enabled=!0,document.body.style.cursor="default",s.script.mouseInput.runable=!1},!1),o.addEventListener("click",function(){for(var r=0;r<t.length;r++)t[r].enabled=!1;e.root.findByName("tree").enabled=!0,document.body.style.cursor="default",s.script.mouseInput.runable=!1},!1),a.addEventListener("click",function(){for(var r=0;r<t.length;r++)t[r].enabled=!1;e.root.findByName("stone").enabled=!0,document.body.style.cursor="default",s.script.mouseInput.runable=!1},!1),d.addEventListener("click",function(){for(var r=0;r<t.length;r++)t[r].enabled=!1;document.body.style.cursor="no-drop",e.root.findByName("eraser").enabled=!0,s.script.mouseInput.runable=!1},!1),i.addEventListener("click",function(){for(var r=0;r<t.length;r++)t[r].enabled=!1;var n=new pc.Entity;n.name="New Path",!1===e.root.findByName("path").enabled&&e.root.addChild(n),e.root.findByName("path").enabled=!0,e.root.findByName("done").enabled=!0,document.body.style.cursor="default",s.script.mouseInput.runable=!1},!1)};var OrthoHeight=pc.createScript("orthoHeight");OrthoHeight.attributes.add("map",{type:"number",default:10,min:10,max:45}),OrthoHeight.prototype.initialize=function(){var t=this;this.app.on("makeGround:ortho",function(){t.setOrtho()})},OrthoHeight.prototype.setOrtho=function(){this.app.root.findByName("Main Camera").camera.orthoHeight=2.3*this.map};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=this._targetYaw-this._yaw,e=i%360;this._targetYaw=e>180?this._yaw-(360-e):e<-180?this._yaw+(360+e):this._yaw+e}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){var t=this,i=function(){t._checkAspectRatio()};window.addEventListener("resize",i,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var e=this.entity.getRotation();if(this._yaw=this._calcYaw(e),this._pitch=this._clampPitchAngle(this._calcPitch(e,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var a=new pc.Vec3;a.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(a.length())}this._targetDistance=this._distance,this.on("attr:distanceMin",function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this.on("attr:distanceMax",function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this.on("attr:pitchAngleMin",function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this.on("attr:pitchAngleMax",function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this.on("attr:focusEntity",function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)}),this.on("attr:frameOnStart",function(t,i){t&&this.focus(this.focusEntity||this.app.root)}),this.on("destroy",function(){window.removeEventListener("resize",i,!1)})},OrbitCamera.prototype.update=function(t){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e=0;if(t.model){var a=t.model.meshInstances;for(e=0;e<a.length;e++)0===i?this._modelsAabb.copy(a[e].aabb):this._modelsAabb.add(a[e].aabb),i+=1}for(e=0;e<t.children.length;++e)i+=this._buildAabb(t.children[e],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var s=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)*pc.math.RAD_TO_DEG};var LogReader=pc.createScript("logReader");LogReader.attributes.add("log",{type:"asset",assetType:"json"}),LogReader.attributes.add("attacker_statBar",{type:"entity"}),LogReader.attributes.add("defender_statBar",{type:"entity"}),LogReader.prototype.initialize=function(){var e=this;this.counter=0,this.forward=1,this.time=0,this.gameLog=JSON.parse(document.getElementById('storage').innerHTML),this.delta=8,this.app.on("changeSpeed",function(t){e.delta=8/t}),this.water="water",this.fire="fire";var t=window.location.href;if(null!==t){t=decodeURI(t);var r=t.indexOf("first_team="),a=t.indexOf("&second_team=");if(-1==r)return;this.water=t.slice(r+11,a),this.water=this.water.split("+").join(" "),this.fire=t.slice(a+13,t.length),this.fire=this.fire.split("+").join(" ")}},LogReader.prototype.update=function(e){if(this.time%this.delta==0&&this.counter<this.gameLog.length&&1==this.app.timeScale){var t=this.gameLog[this.counter];"init"==t.name?(this.app.fire("logReader:init",t),this.initStats(t)):"turn"==t.name?(this.setAttackerStats(t),this.setDefenderStats(t),this.updTowers(t),this.createUnits(t),this.shootTowers(t),this.moveUnits(t),this.destroyTowers(t),this.sendStorm(t),this.sendBean(t),this.destroyUnits(t),this.endOfPath(t)):"status"==t.name&&(this.app.fire("logReader:setTurnA",t.args[0]),this.app.fire("logReader:setTurnD",t.args[0])),++this.counter}else if(this.counter==this.gameLog.length){var r,a,s=this.gameLog[this.counter-1];s.args[1]>s.args[2]?(r=this.water,a="Water"):s.args[1]<s.args[2]?(r=this.fire,a="Fire"):(r=this.water+" and "+this.fire,a=""),this.app.fire("endGame",r,a),++this.counter}this.time++},LogReader.prototype.initStats=function(e){var t=e.args[0].params,r={health:t[0],money:t[1],bean:t[3],storm:t[4],income:0};this.app.fire("logReader:statsBarA",r),this.app.fire("logReader:setTurnA",0),this.app.fire("logReader:statsBarD",r),this.app.fire("logReader:setTurnD",0)},LogReader.prototype.setAttackerStats=function(e){var t=e.args[0].players[0],r={health:t[0],money:t[1],income:t[2],bean:t[3],storm:t[4]};this.app.fire("logReader:statsBarA",r)},LogReader.prototype.setDefenderStats=function(e){var t=e.args[0].players[1],r={health:t[0],money:t[1],income:t[2],bean:t[3],storm:t[4]};this.app.fire("logReader:statsBarD",r)},LogReader.prototype.updTowers=function(e){var t=e.args[0].towers,r=e.args[0].events.updtowers;this.app.fire("logReader:updTowers",t,r)},LogReader.prototype.resurrectTowers=function(e){var t=e.args[0].events.destroyedtowers;this.app.fire("logReader:resurrectTowers",t)},LogReader.prototype.shootTowers=function(e){var t=e.args[0].events.archer,r=e.args[0].events.cannon;this.app.fire("logReader:archerShoot",t),this.app.fire("logReader:cannonShoot",r)},LogReader.prototype.destroyTowers=function(e){var t=e.args[0].events.destroyedtowers;for(i=0;i<t.length;i++){var r=t[i];this.app.fire("logReader:destroyTower",r[1])}},LogReader.prototype.killTowers=function(e){var t=e.args[0].events.updtowers;for(i=0;i<t.length;i++){var r=t[i];this.app.fire("logReader:desÙtroyTower",r[1])}},LogReader.prototype.createUnits=function(e){var t=e.args[0].events.newunits;this.app.fire("logReader:createUnits",t)},LogReader.prototype.resurrectUnits=function(e){var t=e.args[0].events.deadunits,r=e.args[0].events.endofpath;this.app.fire("logReader:resurrectUnits",t,r)},LogReader.prototype.moveUnits=function(e){var t=e.args[0].units;this.app.fire("logReader:moveUnits",t)},LogReader.prototype.destroyUnits=function(e){var t=e.args[0].events.deadunits;this.app.fire("logReader:destroyUnits",t)},LogReader.prototype.killUnits=function(e){var t=e.args[0].events.newunits;this.app.fire("logReader:killUnits",t)},LogReader.prototype.endOfPath=function(e){var t=e.args[0].events.endofpath;this.app.fire("logReader:endOfPath",t)},LogReader.prototype.sendStorm=function(e){for(var t=e.args[0].events.storms,r=0;r<t.length;r++)this.app.fire("logReader:sendStorm",t[r][0],t[r][1])},LogReader.prototype.removeBean=function(e){for(var t=e.args[0].events.beans,r=0;r<t.length;r++)this.app.fire("logReader:removeBean",t[r][0],t[r][1])},LogReader.prototype.sendBean=function(e){for(var t=e.args[0].events.beans,r=0;r<t.length;r++)this.app.fire("logReader:bean",t[r][0],t[r][1])};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),Object.defineProperty(MouseInput.prototype,"runable",{value:!0,writable:!0}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,o=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",o,!1),this.on("destroy",function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",o,!1)})}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,i=MouseInput.worldDiff,s=this.entity.camera,n=this.orbitCamera.distance;s.screenToWorld(t.x,t.y,n,o),s.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),i.sub2(e,o),this.entity.getPosition().y<.1&&(i.y=.1),this.orbitCamera.pivotPoint.add(i),this.oldWorldDiff=i},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInput.prototype.onMouseUp=function(t){if(!1!==this.runable)switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){if(!1!==this.runable){pc.app.mouse;this.lookButtonDown?(this.entity.getPosition().y<.1?this.orbitCamera.pitch-=.1:this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)}},MouseInput.prototype.onMouseWheel=function(t){!1!==this.runable&&(this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault())},MouseInput.prototype.onMouseOut=function(t){!1!==this.runable&&(this.lookButtonDown=!1,this.panButtonDown=!1)};var ClosePlacing=pc.createScript("closePlacing");ClosePlacing.attributes.add("hoverAsset",{type:"asset",assetType:"texture"}),ClosePlacing.attributes.add("activeAsset",{type:"asset",assetType:"texture"}),ClosePlacing.prototype.initialize=function(){this.originalTexture=this.entity.element.textureAsset,this.hovered=!1,this.entity.element.on("mouseenter",this.onEnter,this),this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("mouseleave",this.onLeave,this)},ClosePlacing.prototype.update=function(e){},ClosePlacing.prototype.onPress=function(e){e.element.textureAsset=this.activeAsset;for(var t=this.app.root.findByName("model holder").children,o=0;o<t.length;o++)t[o].enabled=!1;this.app.root.findByName("done").enabled=!1;var s=this.app.root.findByName("New Path");null!==s&&void 0!==s&&(s.enabled=!1,this.app.root.removeChild(s)),this.app.root.findByName("Main Camera").script.mouseInput.runable=!0,this.app.root.findByName("Ground Holder").script.makeGround.removeMode=!1},ClosePlacing.prototype.onEnter=function(e){this.hovered=!0,e.element.textureAsset=this.hoverAsset,document.body.style.cursor="pointer"},ClosePlacing.prototype.onLeave=function(e){this.hovered=!1,e.element.textureAsset=this.originalTexture,document.body.style.cursor="default"},ClosePlacing.prototype.onRelease=function(e){e.element.textureAsset=this.hovered?this.hoverAsset:this.originalTexture};var DynamicSize=pc.createScript("dynamicSize");DynamicSize.prototype.initialize=function(){this.app.root.findByName("dirt")},DynamicSize.prototype.update=function(i){};var AddPath=pc.createScript("addPath");AddPath.prototype.initialize=function(){this.entity.element.on("mouseup",this.onMouseUp,this),this.entity.element.on("mouseenter",function(){document.body.style.cursor="pointer"},this),this.entity.element.on("mouseleave",function(){document.body.style.cursor="default"},this)},AddPath.prototype.update=function(e){},AddPath.prototype.onMouseUp=function(){for(var e=this.app.root.findByName("New Path"),t=!1,n=this.app.root.findByName("Full Path"),i=0;i<n.children.length;i++)if(n.children[i].children.length==e.children.length){for(var o=!0,d=0;d<e.children.length;d++)if(e.children[d].getPosition().x!=n.children[i].children[d].getPosition().x&&e.children[d].getPosition().z!=n.children[i].children[d].getPosition().z){o=!1;break}if(!0===o){t=!0;break}}this.app.root.removeChild(e),!1===t&&n.addChild(e),e.name="Done Path",e.enabled=!1,this.app.root.findByName("path").enabled=!1,this.app.root.findByName("done").enabled=!1};var Game=pc.createScript("Game");Game.attributes.add("hoverAsset",{type:"asset",assetType:"texture"}),Game.attributes.add("activeAsset",{type:"asset",assetType:"texture"}),Game.prototype.initialize=function(){this.originalTexture=this.entity.element.textureAsset,this.hovered=!1,this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("mouseenter",this.onEnter,this),this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseleave",this.onLeave,this)},Game.prototype.update=function(e){},Game.prototype.onRelease=function(e){if(e.element.textureAsset=this.hovered?this.hoverAsset:this.originalTexture,!0===confirm("Do you want to continue ?")){for(var t=this.app.root.findByName("Ground Holder"),o=t.script.makeGround.map,s=o,n=[],i=this.app.root.findByName("Full Path"),r=i.children,a=0;a<r.length;a++){for(var h=r[a].children,u=[],p=0;p<h.length;p++){var l=(h[p].getPosition().x+1.75*o)/3.5,m=(h[p].getPosition().z+1.75*s)/3.5;l-=l%1,m-=m%1;var d={x:m,y:l};u.push(d)}var c={len:h.length,cells:u};n.push(c)}var y=t.script.makeGround.table,v=[50,2e3,1e3,3,3,2,[[40,16,32,1.3,8,2,2,1,2,60,3],[180,60,240,1.3,25,8,4,5,2,15,10]],[[150,50,1.5,40,1.4,3,2,0],[200,70,1.5,10,1.4,4,2,0]]],f={size:[o,s],cells:y},G={map:f,paths:n,params:v},x=[G],A=JSON.stringify(x);this.download("map.map",A),(new XMLHttpRequest).open("GET","",!0)}},Game.prototype.download=function(e,t){var o=document.createElement("a");o.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),o.setAttribute("download",e),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)},Game.prototype.onEnter=function(e){this.hovered=!0,e.element.textureAsset=this.hoverAsset,document.body.style.cursor="pointer"},Game.prototype.onLeave=function(e){this.hovered=!1,e.element.textureAsset=this.originalTexture,document.body.style.cursor="default"},Game.prototype.onPress=function(e){e.element.textureAsset=this.activeAsset};var Pause=pc.createScript("pause");Object.defineProperty(Pause.prototype,"isPaused",{value:!1,writable:!0}),Pause.prototype.initialize=function(){var e=this;this.isPaused=!1,this.app.on("pause",function(){e.togglePaused()})},Pause.prototype.togglePaused=function(){this.isPaused?this.app.timeScale=1:this.app.timeScale=0,this.isPaused=!this.isPaused};var StatsBar=pc.createScript("statsBarA");StatsBar.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),StatsBar.attributes.add("bar_html",{type:"asset",assetType:"html",title:"HTML Asset"}),StatsBar.attributes.add("log",{type:"asset",assetType:"json"}),StatsBar.prototype.initialize=function(){this.suffix="A";var t=document.createElement("style");document.head.appendChild(t),t.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container"+this.suffix),this.div.innerHTML=this.bar_html.resource||"",document.body.appendChild(this.div),this.timer=0;var e=this;this.app.on("logReader:statsBarA",function(t){e.statusUpdate(t)}),this.app.on("logReader:setTurnA",function(t){e.setTurn(t)})},StatsBar.prototype.update=function(t){},StatsBar.prototype.statusUpdate=function(t){var e=this.div.querySelector("#money"+this.suffix),s=this.div.querySelector("#health"+this.suffix),i=this.div.querySelector("#income"+this.suffix),a=this.div.querySelector("#storm"+this.suffix),r=this.div.querySelector("#bean"+this.suffix);e.textContent=t.money,s.textContent=t.health,i.textContent=t.income,a.textContent=t.storm,r.textContent=t.bean},StatsBar.prototype.setTurn=function(t){this.turn=t,this.div.querySelector("#turn"+this.suffix).textContent=this.turn};var Init=pc.createScript("init");Init.attributes.add("side",{type:"entity"}),Init.attributes.add("earthModel",{type:"asset",assetType:"model"}),Init.attributes.add("sandModel",{type:"asset",assetType:"model"}),Init.attributes.add("waterModel",{type:"asset",assetType:"model"}),Init.attributes.add("redTreeModel",{type:"asset",assetType:"model"}),Init.attributes.add("blueTreeModel",{type:"asset",assetType:"model"}),Init.attributes.add("rockModel",{type:"asset",assetType:"model"}),Init.prototype.initialize=function(){var t=this;this.app.on("logReader:init",function(e){t.makeFirstBase(e)})},Init.prototype.makeFirstBase=function(t){var e=this.getMapString(t),a=this.side.findByName("Camera"),s=this.getSize(t);a.camera.orthoHeight=2.75*s,a.rotateLocal(-1*(s-20),0,0),this.drawMap(t,e)},Init.prototype.drawMap=function(t,e){for(var a=this.side.findByName("Ground"),s=this.side.findByName("Blocks"),d=0;d<e.length;d++){var i=this.getXZ(t,d)[0],o=this.getXZ(t,d)[1];"g"==e[d]?"Attacker"==this.side.name?this.addToMap("sand",this.sandModel,a,i,0,o):this.addToMap("water",this.waterModel,a,i,0,o):"r"==e[d]?this.addToMap("road",this.earthModel,a,i,0,o):"w"==e[d]?"Attacker"==this.side.name?this.addToMap("sand",this.sandModel,a,i,0,o):this.addToMap("water",this.waterModel,a,i,0,o):"A"==e[d]?"Attacker"==this.side.name?(this.addToMap("sand",this.sandModel,a,i,0,o),this.addToMap("red tree",this.redTreeModel,s,i,.705,o)):(this.addToMap("water",this.waterModel,a,i,0,o),this.addToMap("blue tree",this.blueTreeModel,s,i,.705,o)):"B"!=e[d]&&"b"!=e[d]||("Attacker"==this.side.name?this.addToMap("sand",this.sandModel,a,i,0,o):this.addToMap("water",this.waterModel,a,i,0,o),this.addToMap("rock",this.rockModel,s,i,.705,o))}},Init.prototype.getSize=function(t){return t.args[0].map.size[0]},Init.prototype.getMapString=function(t){for(var e=t.args[0].map.cells,a="",s=0;s<e.length;s++)a+=e[s];return a},Init.prototype.addToMap=function(t,e,a,s,d,i){var o=new pc.Entity;o.name=t,o.addComponent("model"),o.model.type="asset",o.model.asset=e,o.model.batchGroupId=1e5,o.setPosition(s,d,i),a.addChild(o)},Init.prototype.endOfPath=function(t){for(var e=t.args[0].paths,a=0;a<e.length;a++){var s=e[a].len-1,d=e[a].cells[s],i=this.side.findByName("Ground"),o=Math.sqrt(i.children.length),r=-1.75*o+3.5*d.x+1.75,n=-1.75*o+3.5*d.y+1.75;this.addToMap("end",this.grassModel,i,r,.1,n)}},Init.prototype.getXZ=function(t,e){var a=this.getSize(t);return[-1.75*a+3.5*Math.floor(e/a)+1.75,-1.75*a+e%a*3.5+1.75]};var StatsBar=pc.createScript("statsBarD");StatsBar.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),StatsBar.attributes.add("bar_html",{type:"asset",assetType:"html",title:"HTML Asset"}),StatsBar.attributes.add("log",{type:"asset",assetType:"json"}),StatsBar.prototype.initialize=function(){this.suffix="D";var t=document.createElement("style");document.head.appendChild(t),t.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container"+this.suffix),this.div.innerHTML=this.bar_html.resource||"",document.body.appendChild(this.div),this.timer=0;var e=this;this.app.on("logReader:statsBarD",function(t){e.statusUpdate(t)}),this.app.on("logReader:setTurnD",function(t){e.setTurn(t)})},StatsBar.prototype.update=function(t){},StatsBar.prototype.statusUpdate=function(t){var e=this.div.querySelector("#money"+this.suffix),s=this.div.querySelector("#health"+this.suffix),i=this.div.querySelector("#income"+this.suffix),a=this.div.querySelector("#storm"+this.suffix),r=this.div.querySelector("#bean"+this.suffix);e.textContent=t.money,s.textContent=t.health,i.textContent=t.income,a.textContent=t.storm,r.textContent=t.bean},StatsBar.prototype.setTurn=function(t){this.turn=t,this.div.querySelector("#turn"+this.suffix).textContent=this.turn};var TowerHandler=pc.createScript("towerHandler");TowerHandler.prototype.initialize=function(){var r=this;this.app.on("logReader:updTowers",function(e,o){r.updTowers(e,o)}),this.app.on("logReader:resurrectTowers",function(e){r.resurrectTowers(e)}),this.app.on("logReader:cannonShoot",function(e){r.cannonShoot(e)}),this.app.on("logReader:archerShoot",function(e){r.archerShoot(e)})},TowerHandler.prototype.updTowers=function(r,e){for(var o=0;o<e.length;o++){var t=e[o];if(t[3]){var n=this.getTowerProperties(r,t[1]);this.app.fire("towerHandler:createTowers",t[0],t[1],t[2],n[0],n[1])}else this.app.fire("towerHandler:updateTowers",t[0],t[1],t[2])}},TowerHandler.prototype.resurrectTowers=function(r){for(var e=0;e<r.length;e++){var o=r[e];this.app.fire("towerHandler:resurrectTower",o[0],o[1])}},TowerHandler.prototype.archerShoot=function(r){for(var e=r,o=0;o<r.length;o++){var t=e[o];this.app.fire("towerHandler:archerShoot",t[0],t[1])}},TowerHandler.prototype.cannonShoot=function(r){for(var e=r,o=0;o<r.length;o++){var t=e[o];this.app.fire("towerHandler:cannonShoot",t[0],t[1])}},TowerHandler.prototype.getTowerProperties=function(r,e){for(var o,t=0;t<r.length;t++)r[t][1]==e&&(o=[r[t][2],r[t][4]]);return o};var UnitHandler=pc.createScript("unitHandler");UnitHandler.prototype.initialize=function(){var t=this;this.app.on("logReader:createUnits",function(n){t.createUnits(n)}),this.app.on("logReader:destroyUnits",function(n){t.destroyUnits(n)}),this.app.on("logReader:endOfPath",function(n){t.endOfPath(n)}),this.app.on("logReader:moveUnits",function(n){t.moveUnits(n)}),this.app.on("logReader:resurrectUnits",function(n,r){t.resurrectUnits(n,r)}),this.app.on("logReader:killUnits",function(n){t.killUnits(n)})},UnitHandler.prototype.createUnits=function(t){for(var n=t,r=0;r<n.length;r++){var e=n[r];this.app.fire("unitHandler:createUnits",e[0],e[1][0],e[1][1],e[1][2],e[1][3],e[1][4],e[1][5],e[1][6])}},UnitHandler.prototype.resurrectUnits=function(t,n){for(var r=0;r<t.length;r++){var e=t[r];this.app.fire("unitHandler:resurrectUnit",e[0],e[1])}for(var i=0;i<n.length;i++){var a=n[i];this.app.fire("unitHandler:resurrectUnit",a[0],a[1])}},UnitHandler.prototype.destroyUnits=function(t){for(var n=t,r=0;r<n.length;r++){var e=n[r][1];this.app.fire("unitHandler:destroyUnits",e)}},UnitHandler.prototype.killUnits=function(t){for(var n=0;n<t.length;n++){var r=t[n][1][0];this.app.fire("unitHandler:killUnits",r)}},UnitHandler.prototype.endOfPath=function(t){for(var n=t,r=0;r<n.length;r++){var e=n[r][1];this.app.fire("unitHandler:endOfPath",e)}},UnitHandler.prototype.moveUnits=function(t){for(var n=0;n<t.length;n++){var r=t[n];this.app.fire("unitHandler:moveUnits",r[1],r[4],r[5],r[8])}};var CreateUnits=pc.createScript("createUnits");CreateUnits.attributes.add("mid",{type:"number",enum:[{Attacker:0},{Defender:1}]}),CreateUnits.attributes.add("light",{type:"asset",assetType:"model"}),CreateUnits.attributes.add("heavy",{type:"asset",assetType:"model"}),CreateUnits.prototype.initialize=function(){var t=this;this.superScript=this.app.root.findByName("Root").script.superScript,this.app.on("unitHandler:createUnits",function(e,i,a,s,r,n,o,c){t.mid==e&&t.createUnit(i,a,s,r,n)})},CreateUnits.prototype.createUnit=function(t,e,i,a,s){this.app.fire("createUnits:createNewUnit",this.mid,e);var r=new pc.Entity;r.name="Unit "+t.toString(),r.addComponent("model"),r.model.type="asset","l"==e?(r.model.asset=this.light,r.setLocalScale(.9,.9,.9)):(r.model.asset=this.heavy,r.setLocalScale(1.2,1.2,1.2)),r.setLocalPosition(this.superScript.getLocation(s.y)+3*Math.random()-1.5,.7,this.superScript.getLocation(s.x)+3*Math.random()-1.5),r.addComponent("script"),r.script.create("moveTo"),r.script.create("moveUnits"),r.script.create("clearUnits"),this.entity.addChild(r)};var Shoot=pc.createScript("shoot");Shoot.prototype.initialize=function(){},Shoot.newPosition=new pc.Vec3,Shoot.prototype.update=function(t){var i=this.explode;if(this.direction.lengthSq()>0){var e=this.speed*t,o=Shoot.newPosition;o.copy(this.direction).scale(e),o.add(this.entity.getLocalPosition()),this.entity.setLocalPosition(o),this.distanceToTravel-=e,this.distanceToTravel<=0&&(this.entity.setLocalPosition(this.targetPosition),this.direction.set(0,0,0))}else{if(null!==i){var s=this.entity.getLocalPosition();i.setLocalPosition(s.x,1.5,s.z),i.particlesystem.reset(),i.particlesystem.play()}this.entity.destroy()}},Shoot.prototype.movePlayerTo=function(t,i,e){this.explode=i,this.smoke=e,null!==this.smoke&&(this.smoke.particlesystem.reset(),this.smoke.particlesystem.play()),this.direction=new pc.Vec3,this.distanceToTravel=0,this.targetPosition=new pc.Vec3,this.speed=20,this.targetPosition.copy(t),this.distanceTravelled=0,this.direction.sub2(this.targetPosition,this.entity.getLocalPosition()),this.distanceToTravel=this.direction.length(),this.distanceToTravel>0?(this.direction.normalize(),this.entity.lookAt(this.targetPosition)):this.direction.set(0,0,0)};var Storm=pc.createScript("storm");Storm.prototype.initialize=function(){var t=this;this.superScript=this.app.root.findByName("Root").script.superScript,this.app.on("logReader:sendStorm",function(o,i){t.sendStorm(o,i)})},Storm.prototype.sendStorm=function(t,o){var i=this.app.root.findByName("storm"),r=i.clone();0===t?this.app.root.findByName("Attacker").addChild(r):this.app.root.findByName("Defender").addChild(r),r.setLocalPosition(this.superScript.getLocation(o.y),1.5,this.superScript.getLocation(o.x)),r.particlesystem.play()};var RotateTower=pc.createScript("rotateTower");RotateTower.prototype.initialize=function(){var t=this.entity.getEulerAngles();this.base=new pc.Vec3(Math.sin(t.y*Math.PI/180),0,Math.cos(t.y*Math.PI/180));var e=new pc.Vec3(0,1,0);this.rotate=this.findAngle(this.direction(e)),this.rotated=0,this.entity.lookAt(e)},RotateTower.prototype.update=function(t){},RotateTower.prototype.findAngle=function(t){var e=180*Math.acos(this.base.dot(t.normalize()))/Math.PI;return e=this.base.x<0?e:-e},RotateTower.prototype.direction=function(t){var e=(new pc.Vec3(1,0,1).normalize(),new pc.Vec3);return e.sub2(t,this.entity.getPosition()),e.y=0,e};var Move=pc.createScript("moveBullet");Move.prototype.initialize=function(){this.startTime=0,this.duration=.25,this.run=!1,this.time=pc.math.clamp(this.startTime,0,this.duration),this.lookAt=new pc.Vec3,this.up=new pc.Vec3},Move.prototype.update=function(t){if(this.run){this.time+=t,this.time>this.duration&&(null!==this.explode&&(this.explode.setLocalPosition(this.entity.getLocalPosition()),this.explode.particlesystem.reset(),this.explode.particlesystem.play()),this.entity.destroy());var i=this.time/this.duration;this.entity.setLocalPosition(this.px.value(i),this.py.value(i),this.pz.value(i)),this.lookAt.set(this.tx.value(i),this.ty.value(i),this.tz.value(i)),this.up.set(this.ux.value(i),this.uy.value(i),this.uz.value(i)),this.entity.lookAt(this.lookAt,this.up)}},Move.prototype.createPath=function(t,e,s){var h=pc.CURVE_CARDINAL;this.explode=s,this.px=new pc.Curve,this.px.type=h,this.py=new pc.Curve,this.py.type=h,this.pz=new pc.Curve,this.pz.type=h,this.tx=new pc.Curve,this.tx.type=h,this.ty=new pc.Curve,this.ty.type=h,this.tz=new pc.Curve,this.tz.type=h,this.ux=new pc.Curve,this.ux.type=h,this.uy=new pc.Curve,this.uy.type=h,this.uz=new pc.Curve,this.uz.type=h;var p=[t,e],o=0,a=[],u=new pc.Vec3;for(a.push(0),i=1;i<p.length;i++){var n=p[i-1],r=p[i];u.sub2(n.getLocalPosition(),r.getLocalPosition()),o+=u.length(),a.push(o)}for(i=0;i<p.length;i++){var l=a[i]/o,y=p[i],c=y.getLocalPosition();this.px.add(l,c.x),this.py.add(l,c.y),this.pz.add(l,c.z);var d=c.clone().add(y.forward);this.tx.add(l,d.x),this.ty.add(l,d.y),this.tz.add(l,d.z);var v=y.up;this.ux.add(l,v.x),this.uy.add(l,v.y),this.uz.add(l,v.z)}this.run=!0};var SuperScript=pc.createScript("superScript");SuperScript.prototype.getLocation=function(r){return-1.75*Math.sqrt(this.app.root.findByName("Ground").children.length)+3.5*r+1.75};var CreateTowers=pc.createScript("createTowers");CreateTowers.attributes.add("mid",{type:"number",enum:[{Attacker:0},{Defender:1}]}),CreateTowers.prototype.initialize=function(){var e=this;this.superScript=this.app.root.findByName("Root").script.superScript,this.app.on("towerHandler:createTowers",function(t,r,o,s,a){e.mid==t&&e.createTower(r,o,s,a)})},CreateTowers.prototype.createTower=function(e,t,r,o){var s=new pc.Entity;s.name="Tower "+e.toString(),s.setPosition(this.superScript.getLocation(o.y),.5,this.superScript.getLocation(o.x)),this.entity.addChild(s);var a;"c"==r?a=this.app.assets.get(10980472):"a"==r&&(a=this.app.assets.get(10980435)),s.addComponent("model"),s.model.type="asset",s.model.asset=a,s.model.batchGroupId=100002,s.setLocalScale(1,1.5,1),s.addComponent("script"),s.script.create("updateTowers"),s.script.create("shootTowers"),s.script.create("destroyTower")};var ClearUnits=pc.createScript("clearUnits");ClearUnits.prototype.initialize=function(){var t=this;this.app.on("unitHandler:destroyUnits",function(n){t.entity.name=="Unit "+n.toString()&&t.entity.destroy()}),this.app.on("unitHandler:endOfPath",function(n){t.entity.name=="Unit "+n.toString()&&t.entity.destroy()})};var MoveUnits=pc.createScript("moveUnits");MoveUnits.prototype.initialize=function(){var t=this;this.superScript=this.app.root.findByName("Root").script.superScript,this.app.on("unitHandler:moveUnits",function(i,e,o,n){t.entity.name=="Unit "+i.toString()&&t.moveUnits(i,e,o,n)})},MoveUnits.prototype.moveUnits=function(t,i,e,o){var n=new pc.Vec3(this.superScript.getLocation(e.y)+3*Math.random()-1.5,.7,this.superScript.getLocation(e.x)+3*Math.random()-1.5);try{this.entity.lookAt(n),this.entity.script.moveTo.movePlayerTo(n);var s=i/o;10882989==this.entity.model.asset||10882992==this.entity.model.asset?s*=1.2:s*=.9,this.entity.setLocalScale(s,s,s)}catch(t){}};var MoveTo=pc.createScript("moveTo");MoveTo.prototype.initialize=function(){var t=this;this.direction=new pc.Vec3,this.distanceToTravel=0,this.targetPosition=new pc.Vec3,this.speed=8.25,this.initSpeed(),this.app.on("changeSpeed",function(i){t.speed=8.25*i})},MoveTo.newPosition=new pc.Vec3,MoveTo.prototype.update=function(t){if(this.direction.lengthSq()>0){var i=this.speed*t,e=MoveTo.newPosition;e.copy(this.direction).scale(i),e.add(this.entity.getLocalPosition()),this.entity.setLocalPosition(e),this.distanceToTravel-=i,this.distanceToTravel<=0&&(this.entity.setLocalPosition(this.targetPosition),this.direction.set(0,0,0))}},MoveTo.prototype.movePlayerTo=function(t){this.targetPosition.copy(t),this.targetPosition.y=this.entity.getLocalPosition().y,this.distanceTravelled=0,this.direction.sub2(this.targetPosition,this.entity.getLocalPosition()),this.distanceToTravel=this.direction.length(),this.distanceToTravel>0?(this.direction.normalize(),this.entity.lookAt(this.targetPosition,this.entity.up)):this.direction.set(0,0,0)},MoveTo.prototype.initSpeed=function(){var t=this.app.root.findByName("Control Panel").script.controlPanel;this.speed=8.25*t.getX()};var UpdateTowers=pc.createScript("updateTowers");UpdateTowers.prototype.initialize=function(){var t=this;this.lvl=1,this.shrink=!1,this.expand=!1,this.run=!1,this.changeTo=null,this.speed=16,this.app.on("towerHandler:updateTowers",function(s,i,e){null!==i&&t.entity.name=="Tower "+i.toString()&&t.levelUp(e)}),this.app.on("changeSpeed",function(s){t.speed*=s})},UpdateTowers.prototype.levelUp=function(t){this.lvl=t;var s=1;this.lvl<=2?s+=this.lvl/8:s+=(this.lvl-2)%3/8,this.lvl<=2||(this.lvl<=5?10980435==this.entity.model.asset||10980439==this.entity.model.asset?(this.changeTo=this.app.assets.get(10980439),this.run=!0,this.shrink=!0):(this.changeTo=this.app.assets.get(10980476),this.run=!0,this.shrink=!0):this.lvl<=8?10980439==this.entity.model.asset||10980443==this.entity.model.asset?(this.changeTo=this.app.assets.get(10980443),this.run=!0,this.shrink=!0):(this.changeTo=this.app.assets.get(10980480),this.run=!0,this.shrink=!0):10980443==this.entity.model.asset||10980448==this.entity.model?(this.changeTo=this.app.assets.get(10980448),this.run=!0,this.shrink=!0):(this.changeTo=this.app.assets.get(10980484),this.run=!0,this.shrink=!0)),this.entity.setLocalScale(s,1.5*s,s)};var ShootTowers=pc.createScript("shootTowers");ShootTowers.prototype.initialize=function(){var t=this;this.superScript=this.app.root.findByName("Root").script.superScript,this.app.on("towerHandler:archerShoot",function(o,n){t.entity.name=="Tower "+o.toString()&&t.archerShoot(n)}),this.app.on("towerHandler:cannonShoot",function(o,n){t.entity.name=="Tower "+o.toString()&&t.cannonShoot(n)})},ShootTowers.prototype.archerShoot=function(t){var o=this.app.root.findByName("Unit "+t.toString()),n=o.getPosition();this.entity.lookAt(n),this.app.root.findByName("Control Panel").script.controlPanel.volume&&this.entity.parent.sound.play("gunShot")},ShootTowers.prototype.cannonShoot=function(t){this.app.root.findByName("Control Panel").script.controlPanel.volume&&this.entity.parent.sound.play("gunShot");var o;Math.sqrt(this.entity.parent.parent.findByName("Ground").children.length),new pc.Vec3(this.superScript.getLocation(t.y),1,this.superScript.getLocation(t.x));o="Attacker"==this.entity.parent.parent.name?-200:200;var n=new pc.Vec3(-1*this.superScript.getLocation(t.x)+o,1,-1*this.superScript.getLocation(t.y));this.entity.lookAt(n)};var ControlPanel=pc.createScript("controlPanel");ControlPanel.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),ControlPanel.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),Object.defineProperty(ControlPanel.prototype,"volume",{value:!0,writable:!0}),ControlPanel.prototype.initialize=function(){var e=document.createElement("style");document.head.appendChild(e),e.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container-panel"),this.div.innerHTML=this.html.resource||"",document.body.appendChild(this.div),this.bindEvents(),this.x=1},ControlPanel.prototype.bindEvents=function(){var e=this,t=this.div.querySelector("#play"),n=this.div.querySelector("#speed"),i=this.div.querySelector("#zoom"),s=this.div.querySelector("#sound");t.addEventListener("click",function(){e.app.fire("pause"),e.toggleIcon(t,"statics/play-button.png","statics/pause-button.png")},!1),n.addEventListener("click",function(){e.changeSpeed(n)},!1),i.addEventListener("click",function(){e.app.fire("zoom"),e.toggleIcon(i,"statics/zoom-len.png","statics/zoom-out-magnifier.png")},!1),s.addEventListener("click",function(){e.toggleIcon(s,"statics/high-volume-outline.png","statics/mute-volume.png"),e.volume?e.volume=!1:e.volume=!0},!1)},ControlPanel.prototype.toggleIcon=function(e,t,n){e.getAttribute("src")==n?e.setAttribute("src",t):e.setAttribute("src",n)},ControlPanel.prototype.changeSpeed=function(e){var t=e.innerHTML;"1x"==t?(e.innerHTML="2x",this.app.fire("changeSpeed",2),this.x=2):"2x"==t?(e.innerHTML="4x",this.app.fire("changeSpeed",4),this.x=4):"4x"==t?(e.innerHTML="8x",this.app.fire("changeSpeed",8),this.x=8):"8x"==t?(e.innerHTML="1/4x",this.app.fire("changeSpeed",.25),this.x=.25):"1/4x"==t?(e.innerHTML="1/2x",this.app.fire("changeSpeed",.5),this.x=.5):(e.innerHTML="1x",this.app.fire("changeSpeed",1),this.x=1)},ControlPanel.prototype.getX=function(){return this.x};var DestroyTower=pc.createScript("destroyTower");DestroyTower.prototype.initialize=function(){var t=this;this.shrink=!0,this.run=!1;this.app;this.speed=3,this.app.on("logReader:destroyTower",function(e){t.entity.name=="Tower "+e.toString()&&(t.run=!0)}),this.app.on("changeSpeed",function(e){t.speed*=e})},DestroyTower.prototype.update=function(t){var e=this.entity.getLocalScale();e.y>=.01&&this.shrink&&this.run?this.entity.setLocalScale(e.x-this.speed*t,e.y-this.speed*t,e.z-this.speed*t):this.shrink&&this.run&&(this.shrink=!1,this.entity.destroy())};var Bean=pc.createScript("bean");Bean.attributes.add("mid",{type:"number",enum:[{Attacker:0},{Defender:1}]}),Bean.attributes.add("treeModel",{type:"asset",assetType:"model"}),Bean.prototype.initialize=function(){var e=this;this.superScript=this.app.root.findByName("Root").script.superScript,this.app.on("logReader:bean",function(t,i){if(e.mid==t){var r=new pc.Entity;r.name="tree"+i.y.toString()+i.x.toString(),r.setPosition(e.superScript.getLocation(i.y),.75,e.superScript.getLocation(i.x)),e.entity.addChild(r),r.addComponent("model"),r.model.type="asset",r.model.batchGroupId=1e5,r.addComponent("script"),r.script.create("beanOnTower"),r.script.beanOnTower.go(e.treeModel)}})};var EndGame=pc.createScript("endGame");EndGame.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),EndGame.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),EndGame.prototype.initialize=function(){var e=this,t=document.createElement("style");document.head.appendChild(t),t.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("container-end"),this.div.innerHTML=this.html.resource||"",document.body.appendChild(this.div),this.app.on("endGame",function(t,s){e.showEnd(t,s)})},EndGame.prototype.showEnd=function(e,t){document.getElementsByClassName("container-end")[0].style.display="initial";var s=document.getElementsByClassName("name")[0];s.innerHTML=e,"Fire"==t||"Water"==t?s.setAttribute("class",s.getAttribute("class")+" "+t.toLowerCase()):(document.getElementsByClassName("wins")[0].innerHTML="Win",s.setAttribute("class","both"))};var Zoom=pc.createScript("zoom");Zoom.prototype.initialize=function(){var o=this;this.app.on("zoom",function(){o.zoom()})},Zoom.prototype.zoom=function(){var o=this.app.root.findByName("Attacker").findByName("Camera"),t=this.app.root.findByName("Defender").findByName("Camera"),a=Math.sqrt(o.parent.findByName("Ground").children.length);if(o.camera.orthoHeight==2.75*a)return o.camera.orthoHeight=1.5*a,void(t.camera.orthoHeight=1.5*a);o.camera.orthoHeight=2.75*a,t.camera.orthoHeight=2.75*a};var BeanOnTower=pc.createScript("beanOnTower");BeanOnTower.prototype.initialize=function(){this.shrink=!0,this.expand=!1,this.run=!1,this.speed=2;var e=this;this.app.on("changeSpeed",function(t){e.speed*=t})},BeanOnTower.prototype.go=function(e){var t=this,i=this.app.root.findByName("bean smoke");t.entity.getPosition();t.smoke=i.clone(),t.entity.addChild(t.smoke),t.smoke.setLocalPosition(0,0,0),t.smoke.particlesystem.play(),t.model=e,t.run=!0},BeanOnTower.prototype.update=function(e){var t=this.entity.getLocalScale();t.y>=.01&&this.shrink&&this.run?this.entity.setLocalScale(t.x-this.speed*e,t.y-this.speed*e,t.z-this.speed*e):this.shrink&&this.run&&(this.shrink=!1,this.expand=!0,this.entity.model.asset=this.model),t.y<=1&&this.expand&&this.run?this.entity.setLocalScale(t.x+this.speed*e,t.y+this.speed*e,t.z+this.speed*e):this.expand&&this.run&&(this.expand=!1,this.entity.script.destroy("beanOnTower"))};var Logo=pc.createScript("logo");Logo.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),Logo.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),Logo.prototype.initialize=function(){var e=document.createElement("style");document.head.appendChild(e),e.innerHTML=this.css.resource||"",this.div=document.createElement("div"),this.div.classList.add("logo-panel"),this.div.innerHTML=this.html.resource||"",document.body.appendChild(this.div),this.changeName()},Logo.prototype.changeName=function(){var e=window.location.href,t="",i="";e=decodeURI(e);var s=e.indexOf("first_team="),o=e.indexOf("&second_team=");if(-1!=s){i=e.slice(s+11,o),i=i.split("+").join(" "),t=e.slice(o+13,e.length),t=t.split("+").join(" ");var n=this.div.querySelector("#fire"),a=this.div.querySelector("#water");n.innerHTML=t,a.innerHTML=i}};